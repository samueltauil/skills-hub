---
import Layout from '../../layouts/Layout.astro';
import SkillCard from '../../components/SkillCard.astro';
import skillsData from '../../data/skills.json';

// Define category metadata (icons, names, descriptions)
const categoryMeta: Record<string, { name: string; icon: string; description: string }> = {
  'git-version-control': { name: 'Git & Version Control', icon: 'ğŸ”€', description: 'Skills for Git operations, branching, merging, and version control workflows' },
  'code-quality': { name: 'Code Quality & Refactoring', icon: 'âœ¨', description: 'Skills for improving code quality, refactoring, and following best practices' },
  'documentation': { name: 'Documentation', icon: 'ğŸ“', description: 'Skills for generating and maintaining documentation' },
  'diagrams': { name: 'Diagrams & Visualization', icon: 'ğŸ“Š', description: 'Skills for creating diagrams, flowcharts, and visual representations' },
  'testing': { name: 'Testing', icon: 'ğŸ§ª', description: 'Skills for writing and managing tests' },
  'api-backend': { name: 'API & Backend', icon: 'ğŸ”Œ', description: 'Skills for API development and backend services' },
  'frontend-ui': { name: 'Frontend & UI', icon: 'ğŸ¨', description: 'Skills for frontend development and UI components' },
  'devops-cicd': { name: 'DevOps & CI/CD', icon: 'ğŸš€', description: 'Skills for deployment, CI/CD pipelines, and DevOps workflows' },
  'security': { name: 'Security', icon: 'ğŸ”’', description: 'Skills for security analysis and best practices' },
  'data-analytics': { name: 'Data & Analytics', icon: 'ğŸ“ˆ', description: 'Skills for data processing and analytics' },
  'office-documents': { name: 'Office Documents', icon: 'ğŸ“„', description: 'Skills for working with office documents and formats' },
  'mcp-development': { name: 'MCP Development', icon: 'ğŸ”§', description: 'Skills for Model Context Protocol development' },
  'general': { name: 'General', icon: 'ğŸ“¦', description: 'General-purpose development skills' }
};

export function getStaticPaths() {
  // Define category metadata inside getStaticPaths for build-time access
  const catMeta: Record<string, { name: string; icon: string; description: string }> = {
    'git-version-control': { name: 'Git & Version Control', icon: 'ğŸ”€', description: 'Skills for Git operations, branching, merging, and version control workflows' },
    'code-quality': { name: 'Code Quality & Refactoring', icon: 'âœ¨', description: 'Skills for improving code quality, refactoring, and following best practices' },
    'documentation': { name: 'Documentation', icon: 'ğŸ“', description: 'Skills for generating and maintaining documentation' },
    'diagrams': { name: 'Diagrams & Visualization', icon: 'ğŸ“Š', description: 'Skills for creating diagrams, flowcharts, and visual representations' },
    'testing': { name: 'Testing', icon: 'ğŸ§ª', description: 'Skills for writing and managing tests' },
    'api-backend': { name: 'API & Backend', icon: 'ğŸ”Œ', description: 'Skills for API development and backend services' },
    'frontend-ui': { name: 'Frontend & UI', icon: 'ğŸ¨', description: 'Skills for frontend development and UI components' },
    'devops-cicd': { name: 'DevOps & CI/CD', icon: 'ğŸš€', description: 'Skills for deployment, CI/CD pipelines, and DevOps workflows' },
    'security': { name: 'Security', icon: 'ğŸ”’', description: 'Skills for security analysis and best practices' },
    'data-analytics': { name: 'Data & Analytics', icon: 'ğŸ“ˆ', description: 'Skills for data processing and analytics' },
    'office-documents': { name: 'Office Documents', icon: 'ğŸ“„', description: 'Skills for working with office documents and formats' },
    'mcp-development': { name: 'MCP Development', icon: 'ğŸ”§', description: 'Skills for Model Context Protocol development' },
    'general': { name: 'General', icon: 'ğŸ“¦', description: 'General-purpose development skills' }
  };

  // Generate paths for all categories that have skills
  const categoryIds = [...new Set(skillsData.skills.map(s => s.category || 'general'))].sort();
  
  return categoryIds.map(id => ({
    params: { id },
    props: { 
      category: {
        id,
        name: catMeta[id]?.name || id,
        icon: catMeta[id]?.icon || 'ğŸ“',
        description: catMeta[id]?.description || `Skills in the ${id} category`
      }
    }
  }));
}

const skills = skillsData.skills;

interface Props {
  category: {
    id: string;
    name: string;
    icon: string;
    description: string;
  };
}

const { category } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
const categorySkills = skills.filter(s => (s.category || 'general') === category.id);
---

<Layout title={category.name} description={category.description}>
  <section class="page-header">
    <div class="container">
      <nav class="breadcrumb">
        <a href={`${baseUrl}`}>Home</a>
        <span>/</span>
        <a href={`${baseUrl}categories/`}>Categories</a>
        <span>/</span>
        <span>{category.name}</span>
      </nav>
      
      <div class="category-header">
        <span class="category-icon">{category.icon}</span>
        <div>
          <h1>{category.name}</h1>
          <p class="text-secondary">{category.description}</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <p class="result-count">{categorySkills.length} skill{categorySkills.length !== 1 ? 's' : ''} in this category</p>
      
      {categorySkills.length > 0 ? (
        <div class="grid grid-3">
          {categorySkills.map(skill => (
            <SkillCard 
              id={skill.id}
              name={skill.name}
              description={skill.description}
              category={skill.category || 'general'}
              author={skill.author}
            />
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p>No skills in this category yet.</p>
          <a href="https://github.com/samueltauil/skills-hub/blob/main/CONTRIBUTING.md" class="btn btn-primary">Contribute a Skill</a>
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  .page-header {
    padding: 2rem 0;
    background-color: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
  }

  .breadcrumb a {
    color: var(--color-text-secondary);
  }

  .breadcrumb a:hover {
    color: var(--color-accent);
  }

  .category-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .category-icon {
    font-size: 3rem;
    line-height: 1;
  }

  .category-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .result-count {
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background-color: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .empty-state p {
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
  }
</style>
